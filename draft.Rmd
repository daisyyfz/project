---
title: "Draft"
author: "Daisy Fang"
date: "2/17/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE)
```

```{r load-packages}
library(tidyverse)
library(lubridate)
```

```{r load-data}
all_pallets <- read_csv("all_pallets.csv")
```

```{r clean-data}
# item_category
all_pallets <- all_pallets %>% 
  mutate(item_category = case_when(str_detect(item_desc, "MASHED|MASH|MSHD|SR CRM & CHIVE POTAS") ~ "MASHED POTATO",
                                   str_detect(item_desc, "POT|WEDGE") ~ "OTHER POTATO",
                                   str_detect(item_desc, "MACARONI|MAC") ~ "MAC & CHEESE",
                                   str_detect(item_desc, "LINKS|LINK|LIN|PROLL|ROLL|PATTIES|PATTIS|PAT|PTY|PORK SAUS") ~ "SAUSAGE",
                                   TRUE ~ "OTHERS"))
# proportion check
all_pallets %>% 
  count(item_category) %>% 
  summarize(item_category, n, prop = n/sum(n))

# # check counts to create categories
# all_pallets %>% 
#   filter(item_category == "OTHERS") %>% 
#   filter(!str_detect(item_desc, "LINKS|LINK|LIN|PROLL|ROLL|PATTIES|PATTIS|PAT|PTY|PORK SAUS")) %>% 
#   count(item_desc) %>% 
#   arrange(desc(n))
```




```{r}
sausage <- all_pallets %>% 
  filter(item_category == "SAUSAGE") %>% 
  filter(orig_qty == qty_picked) %>% 
  select(item_category, date_in, latest_date) %>% 
  mutate(date_in = date(date_in),
         #year_week_in = paste(year(date_in), " W", week(date_in), sep = ""),
         date_out = date(latest_date),
         #year_week_out = paste(year(date_out), " W", week(date_out), sep = "")
         ) %>% 
  select(-latest_date)

# sausage time series
sausage %>% 
  mutate(week = week(date_out),
         month = month(date_out),
         year = as.factor(year(date_out))) %>% 
  group_by(year, week) %>% 
  count() %>% 
  ggplot(aes(x = week, y = n, color = year)) +
  geom_line()

test <- all_pallets %>% 
  filter(orig_qty == qty_picked) %>% 
  select(item_category, date_in, latest_date) %>% 
  mutate(date_in = date(date_in),
         #year_week_in = paste(year(date_in), " W", week(date_in), sep = ""),
         date_out = date(latest_date),
         #year_week_out = paste(year(date_out), " W", week(date_out), sep = "")
         ) %>% 
  select(-latest_date)

test %>% 
  mutate(week = week(date_out),
         month = month(date_out),
         year = as.factor(year(date_out))) %>% 
  group_by(year, week, item_category) %>% 
  count() %>% 
  ggplot(aes(x = week, y = n, color = year)) +
  geom_line() +
  facet_grid(item_category ~.)



```

```{r time-series}
test_cnt <- sausage %>% 
  mutate(week = week(date_out),
         month = month(date_out),
         year = as.factor(year(date_out))) %>% 
  group_by(year, week) %>% 
  count() %>% 
  filter(year == 2020)

# one week autocorrelation
acf(test_cnt$n)
```

